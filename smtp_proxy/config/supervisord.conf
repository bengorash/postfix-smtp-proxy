[supervisord]
nodaemon=true
loglevel=info
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[program:rsyslog]
command=/usr/sbin/rsyslogd -n
autostart=true
autorestart=true
priority=10
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[program:postfix]
command=/usr/sbin/postfix -c /etc/postfix start-fg
autostart=true
autorestart=true
priority=20
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
startretries=3
startsecs=5

[program:health-monitor]
command=/usr/local/bin/health_monitor.py
autostart=true
autorestart=true
priority=30
stdout_logfile=/var/log/supervisor/health_monitor.log
stderr_logfile=/var/log/supervisor/health_monitor_error.log

[program:dns-watchdog]
command=bash -c 'while true; do cp /etc/resolv.conf /var/spool/postfix/etc/; sleep 300; done'
autostart=true
autorestart=true
priority=15
stdout_logfile=/var/log/supervisor/dns_watchdog.log
stderr_logfile=/var/log/supervisor/dns_watchdog_error.log

[group:smtp]
programs=rsyslog,postfix,health-monitor,dns-watchdog
priority=999